<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biblioth√®que de CSV</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; display: flex; height: 100vh; margin: 0; background-color: #f9f9f9; }
        #sidebar { width: 350px; border-right: 1px solid #e1e4e8; padding: 1em; overflow-y: auto; background-color: #fff; }
        #content { flex-grow: 1; padding: 1em; overflow: auto; }
        h1, h2, h3 { color: #24292e; }
        ul { list-style: none; padding-left: 20px; }
        li.directory > span { font-weight: bold; cursor: default; color: #586069; }
        li.file > a { text-decoration: none; color: #0366d6; cursor: pointer; display: block; padding: 4px 0; border-radius: 5px; }
        li.file > a:hover { background-color: #f1f8ff; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        th, td { border: 1px solid #dfe2e5; padding: 10px; text-align: left; }
        th { background-color: #f6f8fa; font-weight: 600; }
        #file-name { color: #333; font-family: monospace, monospace; background-color: #eef; padding: 5px; border-radius: 5px;}
        .placeholder { color: #586069; text-align: center; margin-top: 50px; }
        .error { background-color: #fce8e6; border: 1px solid #f9bdbb; padding: 15px; border-radius: 5px; }
    </style>
</head>
<body>

    <div id="sidebar">
        <h2>üìö Biblioth√®que</h2>
        <div id="file-tree"></div>
    </div>

    <div id="content">
        <h1>Contenu du Fichier</h1>
        <h3 id="file-name"></h3>
        <div id="table-container">
            <div class="placeholder">
                <p>Veuillez s√©lectionner un fichier CSV dans la biblioth√®que sur la gauche.</p>
            </div>
        </div>
    </div>

    <script>
    // ##################################################################
    // #                  CONFIGURATION MANUELLE                      #
    // ##################################################################
    //
    // D√©crivez ici l'arborescence de votre dossier "csv".
    // Si vous ajoutez un fichier, mettez √† jour cette liste !
    //
    const fileStructure = [
        { 
            name: "flashcards_formateur.csv", 
            type: "file", 
            path: "csv/flashcards_formateur.csv" 
        },
        {
            name: "Ventes",
            type: "directory",
            children: [
                { 
                    name: "ventes_2024.csv", 
                    type: "file", 
                    path: "csv/Ventes/ventes_2024.csv" 
                },
                { 
                    name: "ventes_2025.csv", 
                    type: "file", 
                    path: "csv/Ventes/ventes_2025.csv" 
                }
            ]
        },
        {
            name: "Marketing",
            type: "directory",
            children: [
                { 
                    name: "campagne_ete.csv", 
                    type: "file", 
                    path: "csv/Marketing/campagne_ete.csv" 
                }
            ]
        }
    ];


    // ##################################################################
    // #                    LOGIQUE DE L'APPLICATION                  #
    // ##################################################################
    
    document.addEventListener('DOMContentLoaded', () => {
        const fileTreeContainer = document.getElementById('file-tree');
        const tableContainer = document.getElementById('table-container');
        const fileNameDisplay = document.getElementById('file-name');

        fileTreeContainer.innerHTML = createTreeHtml(fileStructure);

        function createTreeHtml(nodes) {
            let html = '<ul>';
            nodes.forEach(node => {
                if (node.type === 'directory') {
                    html += `<li class="directory"><span>üìÅ ${node.name}</span>${createTreeHtml(node.children)}</li>`;
                } else if (node.name.toLowerCase().endsWith('.csv')) {
                    html += `<li class="file"><a data-path="${node.path}">üìÑ ${node.name}</a></li>`;
                }
            });
            html += '</ul>';
            return html;
        }

        fileTreeContainer.addEventListener('click', (event) => {
            if (event.target.tagName === 'A' && event.target.dataset.path) {
                const filePath = event.target.dataset.path;
                loadAndDisplayCsv(filePath);
            }
        });

        function loadAndDisplayCsv(path) {
            fileNameDisplay.textContent = path;
            tableContainer.innerHTML = '<p>Chargement...</p>';

            fetch(path)
                .then(response => {
                    if (!response.ok) { throw new Error(`Fichier non trouv√© (statut: ${response.status})`); }
                    return response.text();
                })
                .then(csvText => {
                    const table = document.createElement('table');
                    const rows = csvText.trim().split(/\r?\n/);

                    if (rows.length === 0 || rows[0].trim() === '') {
                        tableContainer.innerHTML = '<p>Le fichier CSV est vide.</p>';
                        return;
                    }

                    const separator = rows[0].includes(';') ? ';' : ',';
                    const headers = rows[0].split(separator);
                    const thead = table.createTHead();
                    const headerRow = thead.insertRow();
                    headers.forEach(header => {
                        const th = document.createElement('th');
                        th.textContent = header.trim();
                        headerRow.appendChild(th);
                    });
                    
                    const tbody = table.createTBody();
                    for (let i = 1; i < rows.length; i++) {
                        if(rows[i].trim() === '') continue;
                        const cells = rows[i].split(separator);
                        const bodyRow = tbody.insertRow();
                        for(let j = 0; j < headers.length; j++) {
                           const td = document.createElement('td');
                           td.textContent = (cells[j] || '').trim();
                           bodyRow.appendChild(td);
                        }
                    }
                    
                    tableContainer.innerHTML = '';
                    tableContainer.appendChild(table);
                })
                .catch(error => {
                    console.error(`Erreur de chargement pour ${path}:`, error);
                    tableContainer.innerHTML = `<div class="error">
                        <h3>Erreur de chargement</h3>
                        <p>Impossible de charger le fichier <code>${path}</code>.</p>
                        <p><strong>V√©rifications :</strong> Le chemin dans la configuration est-il correct ? Le fichier a-t-il bien √©t√© envoy√© sur GitHub ?</p>
                    </div>`;
                });
        }
    });
    </script>
</body>
</html>
